# نظام نقاط البيع (POS) - شركة الفجر الجديدة للاستيراد والتجارة

## معلومات الشركة

### نبذة عن الشركة

- **الاسم**: الفجر الجديدة للاستيراد والتجارة (New Al Fajr for Import & Trade)
- **تأسست**: 1992 (أكثر من 30 سنة خبرة)
- **نوع الشركة**: مؤسسة فردية (Sole Proprietorship)
- **النشاط**: استيراد وتجارة أحبار الطابعات ومستلزمات الطباعة

### معلومات التواصل

- **العنوان**: 73 عمارات استثمار رابعة، مدينة نصر
- **الموبايل**: 01001403093 / 01011910767
- **التليفون**: 02-24156242 / 02-24142417
- **الفاكس**: 02-24195150
- **البريد الإلكتروني**: `Newalfagr@alfagr.me`

### فريق العمل

- **المؤسس**: أ. خالد فوزي
- **المدير التنفيذي**: أ. يحيى خالد
- **مدير المبيعات**: أ. يوسف خالد

---

## هيكل نظام POS

### المخزن الرئيسي (Main Warehouse)

- إدارة المخزون الكامل
- استلام البضائع من الموردين
- توزيع البضائع على منافذ البيع
- تقارير المخزون الشاملة

### منفذ البيع الأول (Outlet 1)

- نقطة بيع مباشرة للعملاء
- مخزون فرعي
- تقارير مبيعات يومية

### منفذ البيع الثاني (Outlet 2)

- نقطة بيع مباشرة للعملاء
- مخزون فرعي
- تقارير مبيعات يومية

---

## المنتجات والخدمات

### أنواع المنتجات

1. **أحبار الطابعات**
   - أحبار أصلية (Original)
   - أحبار متوافقة عالية الجودة (High Copy)
   - أنواع: Laser - Inkjet

2. **تونر آلات التصوير**
   - جميع الماركات العالمية
   - أصلي ومتوافق

3. **الطابعات وآلات التصوير**
   - أجهزة جديدة
   - أجهزة مستعملة بحالة ممتازة

### المميزات التنافسية

- جودة عالية بأسعار تنافسية
- توفر البدائل الأصلية والمتوافقة
- دعم فني سريع ومتاح دائماً

---

## العملاء المستهدفين

1. **شركات الطباعة والمطابع**
2. **المدارس والجامعات**
3. **تجار الجملة في قطاع الطباعة**
4. **الأفراد الباحثين عن جودة مضمونة**

---

## البنية التقنية (Tech Stack)

### Frontend

- **Framework**: React 18+
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **State Management**: Zustand / React Query
- **Routing**: React Router v6
- **Forms**: React Hook Form + Zod
- **UI Components**: Shadcn/ui
- **Icons**: Lucide React
- **Tables**: TanStack Table
- **Charts**: Recharts
- **Print**: React-to-print

### Backend

- **Database**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth
- **Storage**: Supabase Storage (للصور والملفات)
- **Real-time**: Supabase Realtime
- **API**: Supabase Client SDK

### Development Tools

- **Build Tool**: Vite
- **Package Manager**: npm / pnpm
- **Linting**: ESLint
- **Formatting**: Prettier

---

## دورات حياة العمليات (Business Lifecycles)

---

### 1. دورة حياة المبيعات (Sales Lifecycle)

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Sales Lifecycle                                    │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
    │  إنشاء  │────▶│  إضافة  │────▶│  تطبيق  │────▶│  اختيار │
    │ الفاتورة│     │ المنتجات │     │ الخصومات │     │طريقة الدفع│
    └──────────┘     └──────────┘     └──────────┘     └──────────┘
         │                                                   │
         ▼                                                   ▼
    [DRAFT]                                           ┌──────────┐
                                                      │  الدفع   │
                                                      └──────────┘
                                                           │
                                    ┌──────────────────────┼──────────────────────┐
                                    ▼                      ▼                      ▼
                             ┌──────────┐           ┌──────────┐           ┌──────────┐
                             │  نقدي   │           │  آجل    │           │  جزئي   │
                             │  CASH   │           │ CREDIT  │           │ PARTIAL │
                             └──────────┘           └──────────┘           └──────────┘
                                    │                      │                      │
                                    └──────────────────────┼──────────────────────┘
                                                           ▼
                                                    ┌──────────┐
                                                    │  خصم    │
                                                    │ المخزون │
                                                    └──────────┘
                                                           │
                                                           ▼
                                                    ┌──────────┐
                                                    │  طباعة  │
                                                    │ الفاتورة│
                                                    └──────────┘
                                                           │
                                                           ▼
                                                    [COMPLETED]
```

#### حالات فاتورة البيع

| الحالة | الوصف |
|--------|-------|
| `DRAFT` | مسودة فاتورة |
| `PENDING_PAYMENT` | في انتظار الدفع |
| `PARTIALLY_PAID` | مدفوعة جزئياً |
| `PAID` | مدفوعة بالكامل |
| `COMPLETED` | مكتملة |
| `CANCELLED` | ملغاة |
| `REFUNDED` | مرتجعة |

#### أنواع الدفع

| النوع | الوصف |
|-------|-------|
| `CASH` | نقدي |
| `CREDIT` | آجل (على الحساب) |
| `PARTIAL` | دفع جزئي |
| `BANK_TRANSFER` | تحويل بنكي |
| `CHECK` | شيك |

---

### 2. دورة حياة المشتريات (Purchases Lifecycle)

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Purchases Lifecycle                                  │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
    │  طلب    │────▶│  موافقة  │────▶│  إرسال  │────▶│  استلام │
    │  شراء   │     │  داخلية  │     │ للمورد  │     │ البضاعة │
    └──────────┘     └──────────┘     └──────────┘     └──────────┘
         │                │                │                │
         ▼                ▼                ▼                ▼
    [DRAFT]          [APPROVED]       [ORDERED]       [RECEIVING]
         │                                                  │
         ▼                                                  ▼
    [CANCELLED]                                      ┌──────────┐
                                                     │  فحص    │
                                                     │ الجودة  │
                                                     └──────────┘
                                                          │
                                          ┌───────────────┼───────────────┐
                                          ▼               ▼               ▼
                                   ┌──────────┐    ┌──────────┐    ┌──────────┐
                                   │  مطابق  │    │  ناقص   │    │  تالف   │
                                   └──────────┘    └──────────┘    └──────────┘
                                        │               │               │
                                        ▼               ▼               ▼
                                 ┌──────────┐    ┌──────────┐    ┌──────────┐
                                 │ إضافة   │    │  مرتجع  │    │  شطب   │
                                 │للمخزون  │    │ للمورد  │    │         │
                                 └──────────┘    └──────────┘    └──────────┘
                                        │               │               │
                                        └───────────────┼───────────────┘
                                                        ▼
                                                 ┌──────────┐
                                                 │ تسجيل   │
                                                 │ الفاتورة│
                                                 └──────────┘
                                                        │
                                                        ▼
                                                 [COMPLETED]
```

#### حالات فاتورة الشراء

| الحالة | الوصف |
|--------|-------|
| `DRAFT` | مسودة طلب شراء |
| `PENDING_APPROVAL` | في انتظار الموافقة |
| `APPROVED` | تمت الموافقة |
| `ORDERED` | تم الطلب من المورد |
| `PARTIALLY_RECEIVED` | استلام جزئي |
| `RECEIVED` | تم الاستلام |
| `INSPECTED` | تم الفحص |
| `COMPLETED` | مكتمل |
| `CANCELLED` | ملغي |

---

### 3. دورة حياة مرتجعات المبيعات (Sales Returns Lifecycle)

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Sales Return Lifecycle                               │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
    │  طلب    │────▶│  مراجعة  │────▶│  موافقة  │────▶│  استلام  │
    │ المرتجع │     │  الطلب   │     │          │     │ البضاعة  │
    └──────────┘     └──────────┘     └──────────┘     └──────────┘
         │                │                │                │
         ▼                ▼                ▼                ▼
    [PENDING]        [REVIEWING]      [APPROVED]      [RECEIVED]
                          │                               │
                          ▼                               ▼
                     [REJECTED]                    ┌──────────┐
                                                   │  فحص    │
                                                   │ الجودة  │
                                                   └──────────┘
                                                        │
                                          ┌─────────────┴─────────────┐
                                          ▼                           ▼
                                   ┌──────────┐                ┌──────────┐
                                   │  صالح   │                │   تالف   │
                                   │للبيع    │                │          │
                                   └──────────┘                └──────────┘
                                        │                           │
                                        ▼                           ▼
                                 ┌──────────┐                ┌──────────┐
                                 │ إضافة   │                │  شطب    │
                                 │للمخزون  │                │          │
                                 └──────────┘                └──────────┘
                                        │                           │
                                        └─────────────┬─────────────┘
                                                      ▼
                                               ┌──────────┐
                                               │  رد     │
                                               │ المبلغ  │
                                               └──────────┘
                                                    │
                                                    ▼
                                              [COMPLETED]
```

#### حالات مرتجع المبيعات

| الحالة | الوصف |
|--------|-------|
| `PENDING` | طلب مرتجع جديد |
| `REVIEWING` | جاري المراجعة |
| `APPROVED` | تمت الموافقة |
| `REJECTED` | مرفوض |
| `RECEIVED` | تم استلام البضاعة |
| `INSPECTED` | تم الفحص |
| `RESTOCKED` | أُضيف للمخزون |
| `WRITTEN_OFF` | تم الشطب |
| `REFUNDED` | تم رد المبلغ |
| `COMPLETED` | مكتمل |
| `CANCELLED` | ملغي |

---

### 4. دورة حياة مرتجعات المشتريات (Purchase Returns Lifecycle)

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Purchase Return Lifecycle                             │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
    │  إنشاء  │────▶│  موافقة  │────▶│  تجهيز  │────▶│  شحن    │
    │ المرتجع │     │  داخلية  │     │ البضاعة │     │للمورد   │
    └──────────┘     └──────────┘     └──────────┘     └──────────┘
         │                │                │                │
         ▼                ▼                ▼                ▼
    [DRAFT]          [APPROVED]       [PREPARING]      [SHIPPED]
         │                                                  │
         ▼                                                  ▼
    [CANCELLED]                                      ┌──────────┐
                                                     │ استلام  │
                                                     │ المورد  │
                                                     └──────────┘
                                                          │
                                                          ▼
                                                   [RECEIVED_BY_SUPPLIER]
                                                          │
                                          ┌───────────────┴───────────────┐
                                          ▼                               ▼
                                   ┌──────────┐                    ┌──────────┐
                                   │  قبول   │                    │  رفض    │
                                   │ المورد  │                    │ جزئي    │
                                   └──────────┘                    └──────────┘
                                        │                               │
                                        ▼                               ▼
                                 ┌──────────┐                    ┌──────────┐
                                 │ تسوية   │                    │ إعادة   │
                                 │ مالية   │                    │ البضاعة │
                                 └──────────┘                    └──────────┘
                                        │                               │
                                        └─────────────┬─────────────────┘
                                                      ▼
                                               [COMPLETED]
```

#### حالات مرتجع المشتريات

| الحالة | الوصف |
|--------|-------|
| `DRAFT` | مسودة |
| `APPROVED` | موافق عليه |
| `PREPARING` | جاري التجهيز |
| `SHIPPED` | تم الشحن |
| `RECEIVED_BY_SUPPLIER` | استلمه المورد |
| `ACCEPTED` | قبله المورد |
| `PARTIALLY_ACCEPTED` | قبول جزئي |
| `DISPUTED` | نزاع |
| `SETTLED` | تمت التسوية |
| `COMPLETED` | مكتمل |
| `CANCELLED` | ملغي |

---

### 5. دورة حياة تحويل المخزون (Stock Transfer Lifecycle)

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Stock Transfer Lifecycle                              │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
    │  طلب    │────▶│  موافقة  │────▶│  تجهيز  │────▶│  شحن    │
    │ التحويل │     │          │     │ البضاعة │     │         │
    └──────────┘     └──────────┘     └──────────┘     └──────────┘
         │                │                │                │
         ▼                ▼                ▼                ▼
    [PENDING]        [APPROVED]       [PREPARING]      [IN_TRANSIT]
         │                │                                 │
         ▼                ▼                                 ▼
    [CANCELLED]      [REJECTED]                      ┌──────────┐
                                                     │ استلام  │
                                                     │ الفرع   │
                                                     └──────────┘
                                                          │
                                          ┌───────────────┼───────────────┐
                                          ▼               ▼               ▼
                                   ┌──────────┐    ┌──────────┐    ┌──────────┐
                                   │  مطابق  │    │  ناقص   │    │  تالف   │
                                   └──────────┘    └──────────┘    └──────────┘
                                        │               │               │
                                        ▼               ▼               ▼
                                 ┌──────────┐    ┌──────────┐    ┌──────────┐
                                 │ إضافة   │    │  تحقيق  │    │  شطب   │
                                 │للمخزون  │    │         │    │         │
                                 └──────────┘    └──────────┘    └──────────┘
                                        │               │               │
                                        └───────────────┼───────────────┘
                                                        ▼
                                                 [COMPLETED]
```

#### حالات تحويل المخزون

| الحالة | الوصف |
|--------|-------|
| `PENDING` | في انتظار الموافقة |
| `APPROVED` | تمت الموافقة |
| `REJECTED` | مرفوض |
| `PREPARING` | جاري التجهيز |
| `IN_TRANSIT` | في الطريق |
| `PARTIALLY_RECEIVED` | استلام جزئي |
| `RECEIVED` | تم الاستلام |
| `COMPLETED` | مكتمل |
| `CANCELLED` | ملغي |

---

### 6. دورة حياة الجرد (Stock Count/Inventory Audit Lifecycle)

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Stock Count Lifecycle                                 │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
    │  إنشاء  │────▶│  بدء    │────▶│  العد   │────▶│  مراجعة │
    │  الجرد  │     │  الجرد   │     │ الفعلي  │     │ الفروقات│
    └──────────┘     └──────────┘     └──────────┘     └──────────┘
         │                │                │                │
         ▼                ▼                ▼                ▼
    [DRAFT]          [IN_PROGRESS]    [COUNTING]      [REVIEWING]
         │                                                  │
         ▼                                                  ▼
    [CANCELLED]                                      ┌──────────┐
                                                     │ موافقة  │
                                                     │ التسوية │
                                                     └──────────┘
                                                          │
                                                          ▼
                                                   [APPROVED]
                                                          │
                                          ┌───────────────┼───────────────┐
                                          ▼               ▼               ▼
                                   ┌──────────┐    ┌──────────┐    ┌──────────┐
                                   │  زيادة  │    │  نقص    │    │  تالف   │
                                   │ SURPLUS │    │ SHORTAGE│    │ DAMAGED │
                                   └──────────┘    └──────────┘    └──────────┘
                                        │               │               │
                                        ▼               ▼               ▼
                                 ┌──────────┐    ┌──────────┐    ┌──────────┐
                                 │ إضافة   │    │  خصم    │    │  شطب   │
                                 │للمخزون  │    │من المخزون│    │         │
                                 └──────────┘    └──────────┘    └──────────┘
                                        │               │               │
                                        └───────────────┼───────────────┘
                                                        ▼
                                                 ┌──────────┐
                                                 │ تحديث   │
                                                 │ المخزون │
                                                 └──────────┘
                                                        │
                                                        ▼
                                                 [COMPLETED]
```

#### حالات الجرد

| الحالة | الوصف |
|--------|-------|
| `DRAFT` | مسودة |
| `IN_PROGRESS` | جاري |
| `COUNTING` | جاري العد |
| `REVIEWING` | مراجعة الفروقات |
| `APPROVED` | تمت الموافقة على التسوية |
| `ADJUSTING` | جاري التعديل |
| `COMPLETED` | مكتمل |
| `CANCELLED` | ملغي |

#### أنواع فروقات الجرد

| النوع | الوصف |
|-------|-------|
| `SURPLUS` | زيادة في المخزون |
| `SHORTAGE` | نقص في المخزون |
| `DAMAGED` | تالف |
| `EXPIRED` | منتهي الصلاحية |

---

### 7. دورة حياة التالف والهالك (Damaged/Write-off Lifecycle)

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Damaged/Write-off Lifecycle                           │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
    │ اكتشاف  │────▶│  تسجيل  │────▶│  فحص   │────▶│  تصنيف  │
    │ التالف  │     │  البلاغ  │     │ المنتج  │     │         │
    └──────────┘     └──────────┘     └──────────┘     └──────────┘
         │                │                │                │
         ▼                ▼                ▼                ▼
    [DISCOVERED]     [REPORTED]       [INSPECTING]    [CLASSIFIED]
                                                           │
                          ┌────────────────────────────────┼────────────────────────────────┐
                          ▼                                ▼                                ▼
                   ┌──────────┐                     ┌──────────┐                     ┌──────────┐
                   │ قابل    │                     │ غير قابل │                     │ منتهي   │
                   │للإصلاح  │                     │ للإصلاح  │                     │الصلاحية │
                   │REPAIRABLE│                    │UNREPAIRABLE│                   │ EXPIRED │
                   └──────────┘                     └──────────┘                     └──────────┘
                        │                                │                                │
                        ▼                                ▼                                ▼
                 ┌──────────┐                     ┌──────────┐                     ┌──────────┐
                 │  إصلاح  │                     │  موافقة │                     │  موافقة │
                 │         │                     │  الشطب  │                     │  الشطب  │
                 └──────────┘                     └──────────┘                     └──────────┘
                        │                                │                                │
                        ▼                                ▼                                ▼
                 ┌──────────┐                     ┌──────────┐                     ┌──────────┐
                 │ إعادة   │                     │  شطب    │                     │  شطب    │
                 │للمخزون  │                     │ WRITE_OFF│                     │ DISPOSE │
                 └──────────┘                     └──────────┘                     └──────────┘
                        │                                │                                │
                        └────────────────────────────────┼────────────────────────────────┘
                                                         ▼
                                                  [COMPLETED]
```

#### حالات التالف

| الحالة | الوصف |
|--------|-------|
| `DISCOVERED` | تم اكتشافه |
| `REPORTED` | تم الإبلاغ |
| `INSPECTING` | جاري الفحص |
| `CLASSIFIED` | تم التصنيف |
| `PENDING_APPROVAL` | في انتظار الموافقة |
| `APPROVED` | تمت الموافقة |
| `REPAIRING` | جاري الإصلاح |
| `REPAIRED` | تم الإصلاح |
| `WRITTEN_OFF` | تم الشطب |
| `DISPOSED` | تم التخلص منه |
| `COMPLETED` | مكتمل |

#### أنواع التالف

| النوع | الوصف |
|-------|-------|
| `PHYSICAL_DAMAGE` | تلف مادي |
| `WATER_DAMAGE` | تلف بسبب المياه |
| `EXPIRED` | منتهي الصلاحية |
| `MANUFACTURING_DEFECT` | عيب صناعة |
| `STORAGE_DAMAGE` | تلف بسبب التخزين |
| `TRANSIT_DAMAGE` | تلف أثناء النقل |
| `OTHER` | أخرى |

#### أسباب الشطب

| السبب | الوصف |
|-------|-------|
| `DAMAGED` | تالف |
| `EXPIRED` | منتهي الصلاحية |
| `OBSOLETE` | قديم/غير مطلوب |
| `LOST` | مفقود |
| `THEFT` | سرقة |
| `INVENTORY_ADJUSTMENT` | تسوية جرد |

---

### 8. دورة حياة حساب العميل (Customer Account Lifecycle)

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                      Customer Account Lifecycle                              │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐
    │  إنشاء  │────▶│  تفعيل  │────▶│  نشط   │
    │ الحساب  │     │ الحساب  │     │ ACTIVE │
    └──────────┘     └──────────┘     └──────────┘
         │                                 │
         ▼                                 │
    [PENDING]                              │
                                           │
              ┌────────────────────────────┼────────────────────────────┐
              ▼                            ▼                            ▼
       ┌──────────┐                 ┌──────────┐                 ┌──────────┐
       │  بيع    │                 │  سداد   │                 │ مرتجع   │
       │  آجل   │                 │  دفعة   │                 │         │
       └──────────┘                 └──────────┘                 └──────────┘
              │                            │                            │
              ▼                            ▼                            ▼
       ┌──────────┐                 ┌──────────┐                 ┌──────────┐
       │ زيادة   │                 │  خصم   │                 │  خصم   │
       │المديونية│                 │المديونية│                 │المديونية│
       └──────────┘                 └──────────┘                 └──────────┘
              │                            │                            │
              └────────────────────────────┼────────────────────────────┘
                                           ▼
                                    ┌──────────┐
                                    │ تحديث   │
                                    │ الرصيد  │
                                    └──────────┘
                                           │
                    ┌──────────────────────┼──────────────────────┐
                    ▼                      ▼                      ▼
             ┌──────────┐           ┌──────────┐           ┌──────────┐
             │  رصيد   │           │  رصيد   │           │  تجاوز  │
             │  صفر    │           │  دائن   │           │ الحد    │
             └──────────┘           └──────────┘           └──────────┘
                                                                 │
                                                                 ▼
                                                          ┌──────────┐
                                                          │  إيقاف  │
                                                          │ البيع   │
                                                          └──────────┘
```

#### حالات حساب العميل

| الحالة | الوصف |
|--------|-------|
| `PENDING` | في انتظار التفعيل |
| `ACTIVE` | نشط |
| `ON_HOLD` | موقوف مؤقتاً |
| `BLOCKED` | محظور |
| `CLOSED` | مغلق |

#### أنواع معاملات العميل

| النوع | الوصف | التأثير |
|-------|-------|---------|
| `SALE` | بيع آجل | + مديونية |
| `PAYMENT` | سداد | - مديونية |
| `RETURN_REFUND` | رد مرتجع | - مديونية |
| `CREDIT_NOTE` | إشعار دائن | - مديونية |
| `DEBIT_NOTE` | إشعار مدين | + مديونية |
| `OPENING_BALANCE` | رصيد افتتاحي | +/- |

---

### 9. دورة حياة حساب المورد (Supplier Account Lifecycle)

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                       Supplier Account Lifecycle                             │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐
    │  إنشاء  │────▶│  تفعيل  │────▶│  نشط   │
    │ الحساب  │     │ الحساب  │     │ ACTIVE │
    └──────────┘     └──────────┘     └──────────┘
         │                                 │
         ▼                                 │
    [PENDING]                              │
                                           │
              ┌────────────────────────────┼────────────────────────────┐
              ▼                            ▼                            ▼
       ┌──────────┐                 ┌──────────┐                 ┌──────────┐
       │  شراء   │                 │  سداد   │                 │ مرتجع   │
       │  آجل   │                 │  دفعة   │                 │ للمورد  │
       └──────────┘                 └──────────┘                 └──────────┘
              │                            │                            │
              ▼                            ▼                            ▼
       ┌──────────┐                 ┌──────────┐                 ┌──────────┐
       │ زيادة   │                 │  خصم   │                 │  خصم   │
       │المستحق  │                 │المستحق  │                 │المستحق  │
       └──────────┘                 └──────────┘                 └──────────┘
              │                            │                            │
              └────────────────────────────┼────────────────────────────┘
                                           ▼
                                    ┌──────────┐
                                    │ تحديث   │
                                    │ الرصيد  │
                                    └──────────┘
```

#### أنواع معاملات المورد

| النوع | الوصف | التأثير |
|-------|-------|---------|
| `PURCHASE` | شراء آجل | + مستحق |
| `PAYMENT` | سداد | - مستحق |
| `RETURN` | مرتجع للمورد | - مستحق |
| `CREDIT_NOTE` | إشعار دائن | - مستحق |
| `DEBIT_NOTE` | إشعار مدين | + مستحق |
| `OPENING_BALANCE` | رصيد افتتاحي | +/- |

---

### 10. دورة حياة الخصومات والعروض (Discounts & Promotions Lifecycle)

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                     Discounts & Promotions Lifecycle                         │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
    │  إنشاء  │────▶│  مراجعة │────▶│  جدولة  │────▶│  تفعيل  │
    │ العرض   │     │         │     │         │     │         │
    └──────────┘     └──────────┘     └──────────┘     └──────────┘
         │                │                │                │
         ▼                ▼                ▼                ▼
    [DRAFT]          [REVIEWING]     [SCHEDULED]      [ACTIVE]
         │                │                                 │
         ▼                ▼                                 │
    [CANCELLED]      [REJECTED]                            │
                                                           │
                                    ┌──────────────────────┼──────────────────────┐
                                    ▼                      ▼                      ▼
                             ┌──────────┐           ┌──────────┐           ┌──────────┐
                             │ انتهاء  │           │  إيقاف  │           │ استنفاد │
                             │ المدة   │           │  يدوي   │           │ الكمية  │
                             └──────────┘           └──────────┘           └──────────┘
                                    │                      │                      │
                                    └──────────────────────┼──────────────────────┘
                                                           ▼
                                                    [EXPIRED/INACTIVE]
```

#### أنواع الخصومات

| النوع | الوصف |
|-------|-------|
| `PERCENTAGE` | نسبة مئوية |
| `FIXED_AMOUNT` | مبلغ ثابت |
| `BUY_X_GET_Y` | اشتري X واحصل على Y |
| `BUNDLE` | حزمة منتجات |
| `QUANTITY_BREAK` | خصم الكمية |
| `CUSTOMER_SPECIFIC` | خصم خاص بعميل |
| `CATEGORY_DISCOUNT` | خصم على تصنيف |

#### حالات العرض

| الحالة | الوصف |
|--------|-------|
| `DRAFT` | مسودة |
| `SCHEDULED` | مجدول |
| `ACTIVE` | نشط |
| `PAUSED` | متوقف مؤقتاً |
| `EXPIRED` | منتهي |
| `CANCELLED` | ملغي |

---

### 11. دورة حياة المدفوعات (Payments Lifecycle)

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Payments Lifecycle                                  │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐
    │  إنشاء  │────▶│  تأكيد  │────▶│  ترحيل  │
    │ الدفعة  │     │         │     │         │
    └──────────┘     └──────────┘     └──────────┘
         │                │                │
         ▼                ▼                ▼
    [PENDING]        [CONFIRMED]      [POSTED]
         │                │                │
         ▼                ▼                ▼
    [CANCELLED]      [BOUNCED]       [COMPLETED]
                     (للشيكات)
```

#### طرق الدفع

| الطريقة | الوصف |
|---------|-------|
| `CASH` | نقدي |
| `CHECK` | شيك |
| `BANK_TRANSFER` | تحويل بنكي |
| `CREDIT_CARD` | بطاقة ائتمان |
| `MOBILE_PAYMENT` | دفع إلكتروني |

#### حالات الشيك

| الحالة | الوصف |
|--------|-------|
| `PENDING` | في الانتظار |
| `DEPOSITED` | تم الإيداع |
| `CLEARED` | تم التحصيل |
| `BOUNCED` | مرتجع |
| `CANCELLED` | ملغي |

---

### 12. دورة حياة عروض الأسعار (Quotations Lifecycle)

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Quotations Lifecycle                                 │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
    │  إنشاء  │────▶│  إرسال  │────▶│ انتظار  │────▶│  قبول   │
    │ العرض   │     │ للعميل  │     │  الرد   │     │         │
    └──────────┘     └──────────┘     └──────────┘     └──────────┘
         │                │                │                │
         ▼                ▼                ▼                ▼
    [DRAFT]           [SENT]         [PENDING]       [ACCEPTED]
         │                                 │                │
         ▼                                 ▼                ▼
    [CANCELLED]                      ┌──────────┐    ┌──────────┐
                                     │  رفض    │    │ تحويل   │
                                     │         │    │لفاتورة  │
                                     └──────────┘    └──────────┘
                                          │                │
                                          ▼                ▼
                                     [REJECTED]     [CONVERTED]
                                          │
                                          ▼
                                     [EXPIRED]
```

#### حالات عرض السعر

| الحالة | الوصف |
|--------|-------|
| `DRAFT` | مسودة |
| `SENT` | تم الإرسال |
| `PENDING` | في انتظار الرد |
| `ACCEPTED` | مقبول |
| `REJECTED` | مرفوض |
| `EXPIRED` | منتهي الصلاحية |
| `CONVERTED` | تم تحويله لفاتورة |
| `CANCELLED` | ملغي |

---

## أسباب المرتجعات والشطب

### أسباب مرتجعات المبيعات

| السبب | الوصف |
|-------|-------|
| `DEFECTIVE` | عيب في المنتج |
| `WRONG_ITEM` | منتج خاطئ |
| `WRONG_QUANTITY` | كمية خاطئة |
| `CUSTOMER_CHANGE_MIND` | تغيير رأي العميل |
| `NOT_AS_DESCRIBED` | غير مطابق للوصف |
| `DAMAGED_ON_DELIVERY` | تالف عند التسليم |
| `DUPLICATE_ORDER` | طلب مكرر |
| `OTHER` | سبب آخر |

### أسباب مرتجعات المشتريات

| السبب | الوصف |
|-------|-------|
| `DEFECTIVE` | عيب صناعة |
| `WRONG_ITEM` | منتج خاطئ |
| `WRONG_QUANTITY` | كمية خاطئة |
| `DAMAGED` | تالف |
| `EXPIRED` | منتهي الصلاحية |
| `QUALITY_ISSUE` | مشكلة جودة |
| `NOT_AS_ORDERED` | غير مطابق للطلب |
| `OTHER` | سبب آخر |

---

## طرق التسوية المالية

| الطريقة | الوصف | الاستخدام |
|---------|-------|-----------|
| `CASH_REFUND` | رد نقدي | مرتجعات المبيعات |
| `CREDIT_NOTE` | إشعار دائن | مرتجعات المبيعات |
| `ACCOUNT_CREDIT` | خصم من الحساب | العملاء الآجل |
| `EXCHANGE` | استبدال | مرتجعات |
| `FUTURE_INVOICE_CREDIT` | خصم من فاتورة مستقبلية | الموردين |
| `BANK_TRANSFER` | تحويل بنكي | جميع الأنواع |

---

## الصلاحيات والأدوار (Roles & Permissions)

### الأدوار الأساسية

| الدور | الوصف |
|-------|-------|
| `SUPER_ADMIN` | مدير النظام - كل الصلاحيات |
| `ADMIN` | مدير - معظم الصلاحيات |
| `BRANCH_MANAGER` | مدير فرع |
| `ACCOUNTANT` | محاسب |
| `CASHIER` | كاشير |
| `WAREHOUSE_KEEPER` | أمين مخزن |
| `SALES_REP` | مندوب مبيعات |

### مصفوفة الصلاحيات

| الصلاحية | Super Admin | Admin | Branch Manager | Accountant | Cashier | Warehouse |
|----------|-------------|-------|----------------|------------|---------|-----------|
| إدارة المستخدمين | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| إدارة الفروع | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| إدارة المنتجات | ✅ | ✅ | ✅ | ❌ | ❌ | ✅ |
| المبيعات | ✅ | ✅ | ✅ | ❌ | ✅ | ❌ |
| المشتريات | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ |
| المرتجعات | ✅ | ✅ | ✅ | ✅ | ❌ | ✅ |
| الشطب | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ |
| الجرد | ✅ | ✅ | ✅ | ❌ | ❌ | ✅ |
| التحويلات | ✅ | ✅ | ✅ | ❌ | ❌ | ✅ |
| التقارير المالية | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ |
| إدارة العملاء | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ |
| إدارة الموردين | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ |

---

## التقارير المطلوبة

### تقارير المبيعات

- تقرير المبيعات اليومي
- تقرير المبيعات الشهري
- تقرير المبيعات حسب المنتج
- تقرير المبيعات حسب العميل
- تقرير المبيعات حسب الفرع
- تقرير المبيعات حسب الكاشير
- تقرير أفضل المنتجات مبيعاً
- تقرير المبيعات الآجلة

### تقارير المشتريات

- تقرير المشتريات اليومي
- تقرير المشتريات الشهري
- تقرير المشتريات حسب المورد
- تقرير المشتريات حسب المنتج
- تقرير المستحقات للموردين

### تقارير المخزون

- تقرير المخزون الحالي
- تقرير حركة المخزون
- تقرير المنتجات تحت الحد الأدنى
- تقرير المنتجات الراكدة
- تقرير التحويلات بين الفروع
- تقرير الجرد
- تقرير التالف والمشطوب

### تقارير المرتجعات

- تقرير مرتجعات المبيعات
- تقرير مرتجعات المشتريات
- تقرير أسباب المرتجعات
- تقرير المرتجعات حسب المنتج

### تقارير العملاء

- كشف حساب عميل
- تقرير مديونيات العملاء
- تقرير أعمار الديون
- تقرير العملاء الأكثر شراءً

### تقارير الموردين

- كشف حساب مورد
- تقرير المستحقات للموردين
- تقرير أعمار المستحقات

### التقارير المالية

- تقرير الأرباح والخسائر
- تقرير التدفق النقدي
- تقرير المقبوضات
- تقرير المدفوعات

---

## قاعدة البيانات (Database Schema)

### جداول النظام

| الجدول | الوصف |
|--------|-------|
| `branches` | الفروع |
| `users` | المستخدمين |
| `roles` | الأدوار |
| `permissions` | الصلاحيات |
| `role_permissions` | صلاحيات الأدوار |
| `user_branches` | ربط المستخدمين بالفروع |
| `audit_logs` | سجل العمليات |
| `settings` | إعدادات النظام |

### جداول المنتجات والمخزون

| الجدول | الوصف |
|--------|-------|
| `categories` | التصنيفات |
| `brands` | الماركات |
| `units` | وحدات القياس |
| `products` | المنتجات |
| `product_variants` | متغيرات المنتج |
| `inventory` | المخزون لكل فرع |
| `stock_movements` | حركات المخزون |
| `stock_transfers` | تحويلات المخزون |
| `stock_transfer_items` | تفاصيل التحويلات |
| `stock_counts` | الجرد |
| `stock_count_items` | تفاصيل الجرد |
| `stock_adjustments` | تسويات المخزون |

### جداول التالف والشطب

| الجدول | الوصف |
|--------|-------|
| `damaged_items` | المنتجات التالفة |
| `write_offs` | الشطب |
| `write_off_items` | تفاصيل الشطب |
| `damage_reasons` | أسباب التلف |

### جداول العملاء

| الجدول | الوصف |
|--------|-------|
| `customers` | العملاء |
| `customer_groups` | مجموعات العملاء |
| `customer_transactions` | معاملات العملاء |
| `customer_credit_limits` | حدود الائتمان |

### جداول الموردين

| الجدول | الوصف |
|--------|-------|
| `suppliers` | الموردين |
| `supplier_transactions` | معاملات الموردين |
| `supplier_products` | منتجات الموردين |

### جداول المبيعات

| الجدول | الوصف |
|--------|-------|
| `sales` | فواتير المبيعات |
| `sale_items` | تفاصيل المبيعات |
| `sale_payments` | مدفوعات المبيعات |
| `quotations` | عروض الأسعار |
| `quotation_items` | تفاصيل عروض الأسعار |

### جداول المشتريات

| الجدول | الوصف |
|--------|-------|
| `purchase_orders` | أوامر الشراء |
| `purchase_order_items` | تفاصيل أوامر الشراء |
| `purchases` | فواتير المشتريات |
| `purchase_items` | تفاصيل المشتريات |
| `purchase_payments` | مدفوعات المشتريات |
| `goods_receipts` | استلام البضائع |
| `goods_receipt_items` | تفاصيل الاستلام |

### جداول المرتجعات

| الجدول | الوصف |
|--------|-------|
| `sales_returns` | مرتجعات المبيعات |
| `sales_return_items` | تفاصيل مرتجعات المبيعات |
| `purchase_returns` | مرتجعات المشتريات |
| `purchase_return_items` | تفاصيل مرتجعات المشتريات |
| `return_reasons` | أسباب المرتجعات |

### جداول الخصومات والعروض

| الجدول | الوصف |
|--------|-------|
| `discounts` | الخصومات |
| `promotions` | العروض |
| `promotion_products` | منتجات العروض |
| `coupons` | الكوبونات |

### جداول المدفوعات

| الجدول | الوصف |
|--------|-------|
| `payment_methods` | طرق الدفع |
| `payments` | المدفوعات |
| `receipts` | المقبوضات |
| `checks` | الشيكات |
| `credit_notes` | إشعارات دائنة |
| `debit_notes` | إشعارات مدينة |

### جداول الخزينة

| الجدول | الوصف |
|--------|-------|
| `cash_registers` | الخزن |
| `cash_register_sessions` | جلسات الخزينة |
| `cash_movements` | حركات الخزينة |

---

## هيكل المشروع (Project Structure)

```text
alfagr-pos/
├── public/
│   └── logo.jpg
├── src/
│   ├── components/
│   │   ├── ui/                      # Shadcn components
│   │   ├── layout/
│   │   │   ├── Sidebar.tsx
│   │   │   ├── Header.tsx
│   │   │   └── MainLayout.tsx
│   │   ├── common/
│   │   │   ├── DataTable.tsx
│   │   │   ├── SearchInput.tsx
│   │   │   ├── StatusBadge.tsx
│   │   │   └── ConfirmDialog.tsx
│   │   ├── inventory/
│   │   ├── sales/
│   │   ├── purchases/
│   │   ├── returns/
│   │   ├── damaged/
│   │   ├── customers/
│   │   ├── suppliers/
│   │   └── reports/
│   ├── pages/
│   │   ├── auth/
│   │   │   ├── Login.tsx
│   │   │   └── ForgotPassword.tsx
│   │   ├── dashboard/
│   │   │   └── Dashboard.tsx
│   │   ├── inventory/
│   │   │   ├── Products.tsx
│   │   │   ├── Categories.tsx
│   │   │   ├── Brands.tsx
│   │   │   ├── StockLevels.tsx
│   │   │   ├── StockTransfers.tsx
│   │   │   ├── StockCounts.tsx
│   │   │   └── StockAdjustments.tsx
│   │   ├── sales/
│   │   │   ├── POS.tsx
│   │   │   ├── SalesList.tsx
│   │   │   ├── Quotations.tsx
│   │   │   └── SaleDetails.tsx
│   │   ├── purchases/
│   │   │   ├── PurchaseOrders.tsx
│   │   │   ├── PurchasesList.tsx
│   │   │   ├── GoodsReceipt.tsx
│   │   │   └── PurchaseDetails.tsx
│   │   ├── returns/
│   │   │   ├── SalesReturns.tsx
│   │   │   ├── PurchaseReturns.tsx
│   │   │   └── ReturnDetails.tsx
│   │   ├── damaged/
│   │   │   ├── DamagedItems.tsx
│   │   │   └── WriteOffs.tsx
│   │   ├── customers/
│   │   │   ├── CustomersList.tsx
│   │   │   ├── CustomerDetails.tsx
│   │   │   └── CustomerStatement.tsx
│   │   ├── suppliers/
│   │   │   ├── SuppliersList.tsx
│   │   │   ├── SupplierDetails.tsx
│   │   │   └── SupplierStatement.tsx
│   │   ├── payments/
│   │   │   ├── CustomerPayments.tsx
│   │   │   ├── SupplierPayments.tsx
│   │   │   └── Checks.tsx
│   │   ├── reports/
│   │   │   ├── SalesReports.tsx
│   │   │   ├── PurchaseReports.tsx
│   │   │   ├── InventoryReports.tsx
│   │   │   ├── ReturnReports.tsx
│   │   │   ├── CustomerReports.tsx
│   │   │   ├── SupplierReports.tsx
│   │   │   └── FinancialReports.tsx
│   │   └── settings/
│   │       ├── GeneralSettings.tsx
│   │       ├── BranchSettings.tsx
│   │       ├── UserManagement.tsx
│   │       ├── RolesPermissions.tsx
│   │       └── SystemSettings.tsx
│   ├── hooks/
│   │   ├── useAuth.ts
│   │   ├── useInventory.ts
│   │   ├── useSales.ts
│   │   ├── usePurchases.ts
│   │   ├── useReturns.ts
│   │   ├── useDamaged.ts
│   │   ├── useCustomers.ts
│   │   ├── useSuppliers.ts
│   │   ├── usePayments.ts
│   │   └── useReports.ts
│   ├── lib/
│   │   ├── supabase.ts
│   │   ├── utils.ts
│   │   └── constants.ts
│   ├── types/
│   │   ├── database.types.ts
│   │   ├── inventory.ts
│   │   ├── sales.ts
│   │   ├── purchases.ts
│   │   ├── returns.ts
│   │   ├── damaged.ts
│   │   ├── customers.ts
│   │   ├── suppliers.ts
│   │   └── payments.ts
│   ├── stores/
│   │   ├── authStore.ts
│   │   ├── cartStore.ts
│   │   └── settingsStore.ts
│   ├── services/
│   │   ├── inventoryService.ts
│   │   ├── salesService.ts
│   │   ├── purchaseService.ts
│   │   ├── returnService.ts
│   │   ├── damagedService.ts
│   │   └── reportService.ts
│   ├── App.tsx
│   └── main.tsx
├── supabase/
│   └── migrations/
├── .env.local
├── package.json
├── tailwind.config.js
├── tsconfig.json
└── vite.config.ts
```

---

## الشعار

![شعار الشركة](logo.jpg)
